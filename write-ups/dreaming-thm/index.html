<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="">
<meta name="description" content="https://tryhackme.com/room/dreaming
This machine was made by me and my friend Julio. Our Linkedin will be in the end of this write-up in case of any doubts or suggestions you guys have =).
Note: this write-up assumes that you know how the tools being used works and understand some basic concepts like reverse shells, since this is an intermediate CTF level.
Foothold First, we perform a nmap scan to discover what ports are open." />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://b1d0ws.github.io/write-ups/dreaming-thm/" />


    <title>
        
            Dreaming - TryHackMe :: b1d0ws 
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/main.4e5c639214707eff609bb55fe49e183dee42258a73bc90e4cc7b0a84f900798a.css">



    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="msapplication-TileColor" content="">


<meta itemprop="name" content="Dreaming - TryHackMe">
<meta itemprop="description" content="https://tryhackme.com/room/dreaming
This machine was made by me and my friend Julio. Our Linkedin will be in the end of this write-up in case of any doubts or suggestions you guys have =).
Note: this write-up assumes that you know how the tools being used works and understand some basic concepts like reverse shells, since this is an intermediate CTF level.
Foothold First, we perform a nmap scan to discover what ports are open."><meta itemprop="datePublished" content="2022-09-05T11:00:50-03:00" />
<meta itemprop="dateModified" content="2022-09-05T11:00:50-03:00" />
<meta itemprop="wordCount" content="453"><meta itemprop="image" content="https://b1d0ws.github.io/"/>
<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://b1d0ws.github.io/"/>

<meta name="twitter:title" content="Dreaming - TryHackMe"/>
<meta name="twitter:description" content="https://tryhackme.com/room/dreaming
This machine was made by me and my friend Julio. Our Linkedin will be in the end of this write-up in case of any doubts or suggestions you guys have =).
Note: this write-up assumes that you know how the tools being used works and understand some basic concepts like reverse shells, since this is an intermediate CTF level.
Foothold First, we perform a nmap scan to discover what ports are open."/>




    <meta property="og:title" content="Dreaming - TryHackMe" />
<meta property="og:description" content="https://tryhackme.com/room/dreaming
This machine was made by me and my friend Julio. Our Linkedin will be in the end of this write-up in case of any doubts or suggestions you guys have =).
Note: this write-up assumes that you know how the tools being used works and understand some basic concepts like reverse shells, since this is an intermediate CTF level.
Foothold First, we perform a nmap scan to discover what ports are open." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://b1d0ws.github.io/write-ups/dreaming-thm/" /><meta property="og:image" content="https://b1d0ws.github.io/"/><meta property="article:section" content="write-ups" />
<meta property="article:published_time" content="2022-09-05T11:00:50-03:00" />
<meta property="article:modified_time" content="2022-09-05T11:00:50-03:00" /><meta property="og:site_name" content="b1d0ws" />







    <meta property="article:published_time" content="2022-09-05 11:00:50 -0300 -03" />










    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark"> </span>
            <span class="logo__text">/home/b1d0ws</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/certifications/">certifications</a></li><li><a href="/posts/">posts</a></li><li><a href="/write-ups/">write-ups</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="https://b1d0ws.github.io/write-ups/dreaming-thm/">Dreaming - TryHackMe</a></h2>

            
            
            

            <div class="post-content">
                <p><a href="https://tryhackme.com/room/dreaming">https://tryhackme.com/room/dreaming</a></p>
<p><img src="/dreaming/icon.png" alt="icon"></p>
<p><br>
This machine was made by me and my friend Julio. Our Linkedin will be in the end of this write-up in case of any doubts or suggestions you guys have =).</p>
<p>Note: this write-up assumes that you know how the tools being used works and understand some basic concepts like reverse shells, since this is an intermediate CTF level.</p>
<h2 id="foothold"><strong>Foothold</strong></h2>
<p>First, we perform a <em>nmap scan</em> to discover what ports are open.</p>
<p><img src="/dreaming/nmap.png" alt="nmap"></p>
<p><br>
Website is apache default page, so we can enumerate directories with gobuster.</p>
<p><img src="/dreaming/website.png" alt="apache"></p>
<p><img src="/dreaming/goBuster.png" alt="gobuster"></p>
<p><br>
We discover a hidden directory that contains a website CMS called <strong>Pluck</strong>.</p>
<p><img src="/dreaming/app.png" alt="app"></p>
<p><br>
This seems to be a CMS that has an authenticated RCE.</p>
<p><img src="/dreaming/searchsploit.png" alt="searchsploit"></p>
<p><br>
Click on &ldquo;admin&rdquo; to login. We try some common passwords and find that &ldquo;password&rdquo; is the correct one.</p>
<p><em>Note: here we could challenge ourselves and create a script to brute force the password.</em></p>
<p><img src="/dreaming/pluck.png" alt="login"></p>
<p><img src="/dreaming/login.png" alt="admin"></p>
<p><img src="/dreaming/loggedIn.png" alt="loggedIn"></p>
<p><br>
Use the exploit found with searchsploit to get a webshell.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python3 exploit.py <span style="color:#f92672">[</span>IP<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>PORT<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>ADMIN PASSWORD<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>PATH TO PLUCK<span style="color:#f92672">]</span>
</span></span></code></pre></div><p><img src="/dreaming/usingExploit.png" alt="usingExploit"></p>
<p><br>
Upgrade to a reverse shell with mkfifo.</p>
<p><img src="/dreaming/gettingRevShell.png" alt="gettingRevShell"></p>
<h2 id="lucien-flag"><strong>Lucien Flag</strong></h2>
<p>As we note, our user is <em>www-data</em>, so we need to escalate privilege to other users.</p>
<p><img src="/dreaming/listingUsers.png" alt="users"></p>
<p><br>
Doing some manual enumeration, we find lucien password found <strong>/opt/test.py</strong> and can login into SSH with it.</p>
<p><img src="/dreaming/lucienPassword.png" alt="lucienPassword"></p>
<h2 id="death-user"><strong>Death User</strong></h2>
<p>Lucien can execute <em>getDreams.py</em> as death user without a password, but we cannot read it.</p>
<p><img src="/dreaming/lucienSudoers.png" alt="lucienSudoers"></p>
<p><br>
Executing it, we can’t discover many things.</p>
<p><img src="/dreaming/executingGetDreams.png" alt="executingGetDreams"></p>
<p><br>
Inside /opt, there is a copy of getDreams.py. Here we see a mysql connection, but the credentials are redacted.</p>
<p><img src="/dreaming/getDreams.png" alt="getDreams"></p>
<p><br>
Putting the code in a code editor to get the syntax highlighted, we can discover a command injection.</p>
<p><img src="/dreaming/findingCommandInjection.png" alt="findingCommandInjection"></p>
<p><br>
Command execution happens here:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>command <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;echo </span><span style="color:#e6db74">{</span>dreamer<span style="color:#e6db74">}</span><span style="color:#e6db74"> + </span><span style="color:#e6db74">{</span>dream<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span></code></pre></div><p>Variables <em>dreamer</em> and <em>dream</em> come from the mysql connection, so we need to connect to it someway.</p>
<p>We can find the db credentials for Lucien on her <em>.bash_history</em> file.</p>
<p><img src="/dreaming/dbPassword.png" alt="dbPassword"></p>
<p><br>
Enumerating the database library, we see that is here where the information from getDreams are being retrieved.</p>
<p><img src="/dreaming/connectingToDB.png" alt="connectingToDB"></p>
<p><img src="/dreaming/dbPart1.png" alt="dbPart1"></p>
<p><img src="/dreaming/dbPart2.png" alt="dbPart2"></p>
<p><br>
Since lucien can insert into table &ldquo;dreams&rdquo;, we can insert a payload to get us a reverse shell.</p>
<p>Create a bash script file that returns a python reverse shell to be executed.</p>
<p><img src="/dreaming/tmpReverse.png" alt="tmpReverse"></p>
<p><br>
Insert into “dreams” table the payload above and execute getDreams.py as death.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span><span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#a6e22e">dreams</span> (dreamer, dream) <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;aaaa; `/tmp/reverse`;&#39;</span>, <span style="color:#e6db74">&#39;TEST&#39;</span>);
</span></span></code></pre></div><p><img src="/dreaming/deathPrivEsc.png" alt="deathPrivEsc"></p>
<h2 id="morpheus-flag"><strong>Morpheus Flag</strong></h2>
<p>Enumerating Morpheus home, we see that there is a restore file that backup /home/morpheus/kingdom to /kingdom_backup/kingdom.</p>
<p><img src="/dreaming/restoreFile.png" alt="restoreFile"></p>
<p><br>
Here you observe that <em>shutil library</em> is being used.</p>
<p>Searching for this library, we see that death can write into it. Put a python reverse shell inside it and get a reverse shell as Morpheus when restore.py get executed.</p>
<p><img src="/dreaming/shutilLibrary.png" alt="shutilLibrary"></p>
<p><img src="/dreaming/morpheusPrivEsc.png" alt="shutilLibrary"></p>
<p><em>Note: here we could use pspy to confirm that restore.py is being used by a root cronjob.</em></p>
<p>See yaa =).</p>
<p><a href="https://www.linkedin.com/in/eduardo-bido-541430193/">My LinkedIn</a><br>
<a href="https://www.linkedin.com/in/julio-cfa/">Julio&rsquo;s LinkedIn</a></p>

            </div>
        </article>

        <hr />

        <div class="post-info">
            
            
  		</div>
    </main>

            </div>

            
                <footer class="footer">
    
    
</footer>

            
        </div>

        



<script type="text/javascript" src="/bundle.min.feebdc8d801e3fb1791305e362b6d11557f029604dd5b3c27e2686bc88787ee90ae1ccf0afe81bd7d959d7617cfe1fc73062aa82b4e1fa830d6941193d2cbddf.js" integrity="sha512-/uvcjYAeP7F5EwXjYrbRFVfwKWBN1bPCfiaGvIh4fukK4czwr&#43;gb19lZ12F8/h/HMGKqgrTh&#43;oMNaUEZPSy93w=="></script>



    </body>
</html>
