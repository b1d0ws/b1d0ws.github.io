<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="">
<meta name="description" content="https://tryhackme.com/room/dreaming
This machine was made by me and my friend Julio. Our Linkedin will be in the end of this write-up in case of any doubts or suggestions you guys have =).
Note: this write-up assumes that you know how the tools being used works and understand some basic concepts like reverse shells, since this is an intermediate CTF level.
Recon and Helm Flag First, we perform a nmap scan to discover what ports are open." />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://b1d0ws.github.io/write-ups/dreaming-thm/" />


    <title>
        
            Dreaming - TryHackMe :: b1d0ws 
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/main.4e5c639214707eff609bb55fe49e183dee42258a73bc90e4cc7b0a84f900798a.css">



    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="msapplication-TileColor" content="">


<meta itemprop="name" content="Dreaming - TryHackMe">
<meta itemprop="description" content="https://tryhackme.com/room/dreaming
This machine was made by me and my friend Julio. Our Linkedin will be in the end of this write-up in case of any doubts or suggestions you guys have =).
Note: this write-up assumes that you know how the tools being used works and understand some basic concepts like reverse shells, since this is an intermediate CTF level.
Recon and Helm Flag First, we perform a nmap scan to discover what ports are open."><meta itemprop="datePublished" content="2022-09-05T11:00:50-03:00" />
<meta itemprop="dateModified" content="2022-09-05T11:00:50-03:00" />
<meta itemprop="wordCount" content="566"><meta itemprop="image" content="https://b1d0ws.github.io/"/>
<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://b1d0ws.github.io/"/>

<meta name="twitter:title" content="Dreaming - TryHackMe"/>
<meta name="twitter:description" content="https://tryhackme.com/room/dreaming
This machine was made by me and my friend Julio. Our Linkedin will be in the end of this write-up in case of any doubts or suggestions you guys have =).
Note: this write-up assumes that you know how the tools being used works and understand some basic concepts like reverse shells, since this is an intermediate CTF level.
Recon and Helm Flag First, we perform a nmap scan to discover what ports are open."/>




    <meta property="og:title" content="Dreaming - TryHackMe" />
<meta property="og:description" content="https://tryhackme.com/room/dreaming
This machine was made by me and my friend Julio. Our Linkedin will be in the end of this write-up in case of any doubts or suggestions you guys have =).
Note: this write-up assumes that you know how the tools being used works and understand some basic concepts like reverse shells, since this is an intermediate CTF level.
Recon and Helm Flag First, we perform a nmap scan to discover what ports are open." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://b1d0ws.github.io/write-ups/dreaming-thm/" /><meta property="og:image" content="https://b1d0ws.github.io/"/><meta property="article:section" content="write-ups" />
<meta property="article:published_time" content="2022-09-05T11:00:50-03:00" />
<meta property="article:modified_time" content="2022-09-05T11:00:50-03:00" /><meta property="og:site_name" content="b1d0ws" />







    <meta property="article:published_time" content="2022-09-05 11:00:50 -0300 -03" />










    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark"> </span>
            <span class="logo__text">/home/b1d0ws</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/certifications/">certifications</a></li><li><a href="/posts/">posts</a></li><li><a href="/write-ups/">write-ups</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="https://b1d0ws.github.io/write-ups/dreaming-thm/">Dreaming - TryHackMe</a></h2>

            
            
            

            <div class="post-content">
                <p><a href="https://tryhackme.com/room/dreaming">https://tryhackme.com/room/dreaming</a></p>
<p><img src="/dreaming/sandmanIcon.jpg" alt="sandmanIcon"></p>
<p>This machine was made by me and my friend Julio. Our Linkedin will be in the end of this write-up in case of any doubts or suggestions you guys have =).</p>
<p>Note: this write-up assumes that you know how the tools being used works and understand some basic concepts like reverse shells, since this is an intermediate CTF level.</p>
<h2 id="recon-and-helm-flag"><strong>Recon and Helm Flag</strong></h2>
<p>First, we perform a <em>nmap scan</em> to discover what ports are open.</p>
<p><img src="/dreaming/initial-nmap.png" alt="nmap"></p>
<p>I perform an aggressive scan after that but nothing interesting comes up.</p>
<p><br>
Since FTP is available, we can connect with <em>anonymous Login</em>.</p>
<p><img src="/dreaming/ftp-anonymous.png" alt="ftp"></p>
<p><br>
That works, so we find a zip file, but as we can see, it is protected by a <em>password</em>.</p>
<p><img src="/dreaming/zip-password-protected.png" alt="zip-password"></p>
<p><br>
We can crack the password with <em>zip2john</em> and extract the files.</p>
<p><img src="/dreaming/zip-cracking.png" alt="zip-password"></p>
<p><br>
Doing that, we have 3 text files, one of them has our <em>first flag</em> and other indicate to us that there is a website in this server and a show a possible password: <em>matthew333#</em></p>
<p><img src="/dreaming/reading-files.png" alt="zip-cracking"></p>
<h2 id="first-access"><strong>First Access</strong></h2>
<p>Accessing the website, it seems that there is nothing on the main page.</p>
<p><img src="/dreaming/website.png" alt="website"></p>
<p><br>
Doing some enumeration with <em>GoBuster</em>, we discover a hidden directory that contains a website CMS called <em>Pluck</em>.</p>
<p><img src="/dreaming/gobuster.png" alt="gobuster"></p>
<p><img src="/dreaming/accessing-app.png" alt="app"></p>
<p><img src="/dreaming/accessing-dream.png" alt="dream"></p>
<p><br>
There is a link to access <em>admin page</em> and we can access the panel with the password we found before.</p>
<p><img src="/dreaming/admin-login.png" alt="login"></p>
<p><img src="/dreaming/admin-panel.png" alt="admin"></p>
<p><br>
At the bottom of the page, we discover that the CMS being used is <em>Pluck 4.7.13</em>, so we can use <em>searchsploit</em> to look for it.</p>
<p>Doing that, we find a <em>public exploit</em> that can be used to create a webshell.</p>
<p><img src="/dreaming/searchsploit.png" alt="searchsploit"></p>
<p><br>
The usage is: <em>python3 exploit.py [IP] [PORT] [ADMIN PASSWORD] [PATH TO PLUCK]</em></p>
<p><img src="/dreaming/using-exploit.png" alt="exploit"></p>
<p><br>
From the webshell we can make a <em>reverse shell</em> to get control via command line.</p>
<p><img src="/dreaming/webshell.png" alt="webshell"></p>
<h2 id="lucien-flag"><strong>Lucien Flag</strong></h2>
<p>As we note, our user is <em>www-data</em>, so we need to escalate privilege to other users.</p>
<p>First, we upload <em>linpeas</em> to the machine using <em>python and wget</em>.</p>
<p><img src="/dreaming/linpeas-download.png" alt="webshell"></p>
<p><br>
Running linpeas.sh, we observe that <em>/etc/shadow is readable</em> to everyone, so we can <em>unshadow and crack it with john</em>.</p>
<p><img src="/dreaming/linpeas-shadow.png" alt="linpeas-shadow"></p>
<p><br>
To copy these files to my machine, I simply read with cat to copy and paste into text files in my host.</p>
<p><img src="/dreaming/cracking-lucien.png" alt="unshadow"></p>
<p><br>
Now just login into Lucien and read her flag.</p>
<p><img src="/dreaming/lucien-flag.png" alt="lucien-flag"></p>
<h2 id="death-flag"><strong>Death Flag</strong></h2>
<p>Enumerating the machine, listing the listening ports, we discover that there is a <em>mysql running</em>.</p>
<p><img src="/dreaming/listing-ports.png" alt="listing-ports"></p>
<p>We try to connect in mysql with Lucien credentials and succeed.</p>
<p>There is an interesting <em>database called dreamers</em>, so we decide to take a look into it.</p>
<p><img src="/dreaming/connecting-mysql.png" alt="mysql"></p>
<p><br>
We see that there some data and one string called our attention that seems it is a <em>base64 encoded text</em>.</p>
<p>When we decode it, we discover the <em>password</em> for death user.</p>
<p><img src="/dreaming/mysql-password.png" alt="dreamers"></p>
<p><img src="/dreaming/death-flag.png" alt="death-flag"></p>
<h2 id="morpheus-flag"><strong>Morpheus Flag</strong></h2>
<p>In death’s home, we see that here is a file called <em>restore.py</em>, but this file is owned by Root and we can’t execute it.</p>
<p><img src="/dreaming/restore-py.png" alt="restore"></p>
<p><br>
Doing more enumeration, we observe that death can run this file with python3 with <em>Morpheus permissions</em>.</p>
<p><img src="/dreaming/first-use.png" alt="mysql"></p>
<p><br>
Analyzing what the python code does, it is doing the backup of the dream kingdom calling a <em>&ldquo;shutil&rdquo;</em> library.</p>
<p>Since we can run it as morpheus and it is calling a python library, we can escalate privilege with the <em>Python Library Hijacking</em> technique.</p>
<p>First, we copy the file of the library located in <em>/usr/lib/python3.10/shutil.py</em> to <em>/tmp/</em> directory, insert a <em>reverse shell</em> inside it and <em>call the restore.py as Morpheus</em>.</p>
<p><img src="/dreaming/copy-shutil.png" alt="copy-shutil"></p>
<p><img src="/dreaming/shutil-py.png" alt="shutil-py"></p>
<p><br>
Finally, we get the connection with Morpheus user and find the last flag.</p>
<p><img src="/dreaming/morpheus-flag.png" alt="morpheus-flag"></p>
<p>See yaa =).</p>
<p><a href="https://www.linkedin.com/in/eduardo-bido-541430193/">My LinkedIn</a><br>
<a href="https://www.linkedin.com/in/julio-cfa/">Julio&rsquo;s LinkedIn</a></p>

            </div>
        </article>

        <hr />

        <div class="post-info">
            
            
  		</div>
    </main>

            </div>

            
                <footer class="footer">
    
    
</footer>

            
        </div>

        



<script type="text/javascript" src="/bundle.min.cf7fb2a9e24608a783e05e4472da2fdf008293289de1ad88d1cba5c143e7e414496dd33b6a228e92f8461ce0c8cbad3c9f9847e73e46dfbce0463393ddd1733a.js" integrity="sha512-z3&#43;yqeJGCKeD4F5Ectov3wCCkyid4a2I0culwUPn5BRJbdM7aiKOkvhGHODIy608n5hH5z5G37zgRjOT3dFzOg=="></script>



    </body>
</html>
